- name: Make sure required packages are installed
  hosts: all
  become: yes
  tasks:
  - name: Create the script on the remote server
    shell: |
      cat << 'EOF' > /tmp/run_in_container.sh
      expect <<EOF
      spawn vosctl sh
      expect "*# "
      send "rm -f /var/lib/persistent/licensing/new_iso_install\r"
      expect "*# "
      send "exit\r"
      expect eof
      EOF
      EOF
    mode: '0755'

  - name: Execute the script on the remote server
    shell: /tmp/run_in_container.sh